<!DOCTYPE html>
<html>
<head>
    <title>Dragon Tiger Login</title>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <style>
        /* Existing styles remain the same */
        
        /* New style for history button */
        .history-btn {
            background: linear-gradient(to right, #8e2de2, #4a00e0);
            color: white;
            padding: 14px;
            width: 100%;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            margin-top: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .history-btn:hover {
            background: linear-gradient(to right, #7d26c5, #3d00b8);
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="login-container">
            <div class="logo">DRAGON TIGER</div>
            <p class="subtitle">Experience the thrill of the game</p>
            
            <div class="dragon-tiger">
                <div class="dragon">D</div>
                <div class="tiger">T</div>
            </div>
            
            <h1>User Login</h1>
            <input type="text" id="email" placeholder="Email" required>
            <input type="password" id="password" placeholder="Password" required>
            <button onclick="login()">Login</button>
            
            <button class="history-btn" onclick="window.location.href='history.html'">
                <i class="fas fa-history"></i> View Game History
            </button>
            
            <p id="error"></p>
        </div>
        
        <div class="game-info">
            <h2>About Dragon Tiger Game</h2>
            <p>A fast-paced casino card game where players bet on whether the Dragon or Tiger hand will have the higher card.</p>
            
            <div class="features">
                <div class="feature">
                    <h3>Fast Gameplay</h3>
                    <p>Quick rounds with instant results</p>
                </div>
                <div class="feature">
                    <h3>Live Dealers</h3>
                    <p>Real dealers streamed in HD</p>
                </div>
                <div class="feature">
                    <h3>Secure</h3>
                    <p>Encrypted transactions</p>
                </div>
            </div>
            
            <div style="margin-top: 30px; background: rgba(0, 0, 0, 0.1); padding: 15px; border-radius: 10px;">
                <h3>How to Play</h3>
                <p>1. Place your bet on Dragon, Tiger, or Tie</p>
                <p>2. One card is dealt to Dragon and one to Tiger</p>
                <p>3. Highest card wins, same card is a tie</p>
                <p>4. Each round has 20 seconds betting time</p>
            </div>
        </div>
    </div>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyBO7dxMxJwcSEceULVYH0K6n8d59wALw7U",
            authDomain: "dragon-tiger-game-8b5b0.firebaseapp.com",
            projectId: "dragon-tiger-game-8b5b0",
            storageBucket: "dragon-tiger-game-8b5b0.firebasestorage.app",
            messagingSenderId: "885603497015",
            appId: "1:885603497015:web:afc57007437a3166ecfbb2"
        };
        
        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
        } catch (e) {
            console.error("Firebase init error:", e);
        }

        // Login function with account blocking check
        function login() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            const errorEl = document.getElementById("error");
            
            // Reset error message
            errorEl.style.display = 'none';
            errorEl.innerText = "";
            
            if (!email || !password) {
                errorEl.innerText = "Please enter email and password";
                errorEl.style.display = 'block';
                return;
            }
            
            // Show loading state on button
            const loginBtn = document.querySelector('button');
            const originalBtnText = loginBtn.innerText;
            loginBtn.innerText = 'Logging in...';
            loginBtn.disabled = true;
            
            firebase.auth().signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Check if user is blocked
                    const userId = userCredential.user.uid;
                    return firebase.firestore().collection("users").doc(userId).get();
                })
                .then(doc => {
                    if (doc.exists) {
                        const userData = doc.data();
                        if (userData.isBlocked) {
                            firebase.auth().signOut();
                            throw new Error("Your account is blocked!");
                        }
                        window.location.href = "game.html";
                    } else {
                        throw new Error("User data not found");
                    }
                })
                .catch(error => {
                    console.error("Login error:", error);
                    errorEl.innerText = error.message || "Invalid ID/Password or user not found";
                    errorEl.style.display = 'block';
                })
                .finally(() => {
                    loginBtn.innerText = originalBtnText;
                    loginBtn.disabled = false;
                });
        }
    </script>
</body>
</html>